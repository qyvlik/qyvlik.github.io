# App 扫描二维码登陆网站


```
+-----------+-----------+-----------+
|    App    |    Web    |   Server  |
+-----------+-----------+-----------+
|           | 1.qrcode  |           |
| 2.scan    | 2.loop    |           |
| 3.send    |           |           |
|           |           | 4.auth    |
|           |           | 5.push    |
| 6.receive | 6.refresh |           |
+-----------+-----------+-----------+
```

1. Web 请求扫码登陆的 qrcode

2. Web 轮询 qrcode 的状态

3. App 开启扫码，并点击登陆(或者取消登陆)

4. 服务端收到 App 的登陆请求，进行认证

5. 成功登陆

6. Web 轮询到状态变更，刷新页面

## 二维码状态

```                      
  +-------+          +---------+        +--------+
  | valid |  ---->   | scanned |  --->  | cancel |
  +-------+          +---------+        +--------+
      | (over time)        |    
      v                    v    
  +---------+        +---------+
  | invalid | <----  | confirm |
  +---------+        +---------+
```

- `valid` : `1` 二维码有效

- `scanned` : `2` 二维码已被扫描

- `confirm` : `3` 用户确认登陆

- `invalid` : `4` 二维码失效，例如超时，或者用户拒绝登陆，或者登陆后失效

- `cancel` : `5` 用户取消二维码登陆

## 参考资料

[微信扫描二维码登录网页是什么原理，前后两个事件是如何联系的？](https://www.zhihu.com/question/20368066)

